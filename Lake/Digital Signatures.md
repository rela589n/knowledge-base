### Загальні терміни  
  
ЦСК (certificate authority) - "надійна" організація, яка видає сертифікат.  
  
Приватний ключ - ключ, яким підписуються документи. Може зберігатись в мережевому криптомодулі.

Зазвичай приватний ключ також захищений паролем (passphrase-encrypted), і при підписі також треба буде пароль.  
  
Публічний ключ - ключ, яким перевіряється автентичність підпису.  
Для юридичної перевірки підпису треба не лише публічний ключ, а сертифікат публічного ключа.  
  
Підпис - зашифрована приватним ключем хеш-сума документа. В процесі підписання з вмісту генерується хеш-сума,  
шифрується приватним ключем користувача, і об'єднується з оригінальними даними документа.  
  
Перевірка підпису - процес, за якого з підписаного документа отримується його оригінальний контент та підпис  
(зашифрована хеш-сума). Підпис розшифровується публічним ключем особи, що підписувала документ. Отримана розшифруванням  
хеш-сума звіряється з хеш-сумою оригінального контенту документа. Якщо збігаються - підпис валідний. Також, окрім самого  
підпису обов'язково перевіряється сертифікат публічного ключа.  
  
Сертифікат (публічного ключа) - підписаний ЦСК публічний ключ особи. Видається лише уповноваженими організаціями (ЦСК).  
Юридично цей сертифікат є підтвердженням для конкретної особи, що це її публічний ключ (а якщо публічний ключ належить  
їй, то відповідно також і приватний ключ, яким робляться підписи). Фізично сертифікат - це і є публічний ключ +  
додаткова інформація про особу, і все це підписано приватним ключем ЦСК. Сертифікат не є вічним, а видається на  
певний час (ttl).  
  
Сертифікат може містити в собі адресу OSCP-сервера, яким можна перевірити його валідність.  
  
Відкликаний сертифікат - сертифікат публічного ключа, що більше не вважається дійсним (до завершення строку його дії), і  
є доданим до списку відкликаних сертифікатів (СВС). В момент часу, коли сертифікат додається до СВС, він втрачає  
юридичну силу.  
Фізично ніщо не заважає здійснити підпис з цим сертифікатом, але якщо дата даного підписання пізніше за дату  
відкликання, то підпис не має жодної юридичної сили. Саме тому при компрометації приватного ключа важливо одразу  
відкликати сертифікат.  
  
CLR (Certificate Revocation List) - список відкликаних сертифікатів (СВС).  
  
OSCP-сервер - сервер ЦСК, який реалізовує перевірку валідності сертифіката.  
На нього можна відправити запит з заданим сертифікатом і сервер поверне чи він валідний, одразу перевіривши базу CLR.  
  
CMP (Certificate Management Protocol) - протокол управління сертифікатами (випуск, поновлення, відкликання)  
  
### Підписання  
  
Для підпису треба:  
  
1. Сертифікат публічного ключа - підпис не матиме юридичної сили, якщо він зроблений приватним ключем, відповідний  
   публічний ключ якого не сертифіковано в ЦСК;  
2. Приватний ключ, що відповідає публічному ключеві з сертифіката - використовується для накладення підпису.  
  
Щоб не створювати юридично недійсний підпис, при підписанні попередньо перевіряється:  
  
1. Дійсність сертифіката публічного ключа. Тобто, перевірка що даний сертифікат був справді випущений авторизованим ЦСК. 
2. Термін дії сертифіката (ttl).  
3. Відсутність сертифіката в списку відкликаних сертифікатів (СВС).  
  
Всі ці три пункти перевіряються OSCP-сервером ЦСК.  
  
Також, в обов'язковому порядку перевіряється легітимність сертифіката ЦСК.  
  
### Перевірка легітимності сертифіката  
  
Коли перевіряється дійсність сертифіката, має бути перевірено весь ланцюг підписів сертифікатів.  
Тобто, якщо це сертифікат конкретної особи, то перевірка міститиме наступні кроки:  
  
- перевірка підпису даного сертифіката публічним ключем (який отримали з сертифіката) ЦСК, що підписував;  
- перевірка сертифіката ЦСК (знову ж таки, сертифікат - це підписаний публічний ключ) публічним ключем батьківського  
  ЦСК;  
- перевірка сертифіката батьківського ЦСК публічним ключем його батьківського;  
- перевірка само-підписаного сертифіката ЦСК верхнього рівня, який вважається довіреним.  
  
Тобто, ЦСК верхнього рівня, підписавши сертифікат ЦСК рівня нижче делегує йому довіру, бо всі сертифікати цього ЦСК  
також будуть вважатись валідними.  
  
Ланцюг кореневих сертифікатів зберігається в файлі `.p7b`.  
  
### Перевірка статусу сертифіката через OCSP  
  
Довіра до OCSP-сервера, що вказаний в сертифікаті базується на тому, що перевіривши легітимність самого сертифіката, ми  
знаємо що інформація в ньому не була змінена, - а відповідно вказаний OCSP-сервер може використовуватись для перевірки.  
  
Також, відповідь від OCSP-сервера має бути підписана ЦСК, що випустив сертифікат, - таким чином підпис даної відповіді  
також перевіряється на легітимність по ланцюгу довіри.  
  
### Накладання часової мітки  
  
Відбувається звернення на TSP-сервер (TSA - Time Stamping Authority), куди передається хеш-сума документа. Сервер  
отримує точне значення поточного часу, і накладає на дану інформацію підпис своїм приватним ключем.  
  
Таким чином, маючи підписану часову мітку, і перевіривши валідність та легітимність даного підпису, можна точно  
стверджувати що документ був підписаний в конкретний момент часу.  
  
По ідеї ЦСК можуть реалізовувати TSP-функціонал. Або це може бути будь-який інший довірений (сертифікат якого  
знаходиться в списку довірених) сервіс.